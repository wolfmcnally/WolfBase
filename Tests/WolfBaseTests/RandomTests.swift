import XCTest
import WolfBase

let testSeed: (UInt64, UInt64, UInt64, UInt64) = (17295166580085024720, 422929670265678780, 5577237070365765850, 7953171132032326923)

class RandomTests: XCTestCase {
    func testXoshiro256StarStar0() {
        var rng = Xoshiro256StarStar(state: testSeed)
        XCTAssertEqual(rng.next(), 1104683000648959614)
    }
    
    func testXoshiro256StarStar1() {
        var rng = Xoshiro256StarStar(state: testSeed)
        XCTAssertEqual((0..<50).map { _ in rng.next() }, [1104683000648959614, 9817345228149227957, 546276821344993881, 15870950426333349563, 830653509032165567, 14772257893953840492, 3512633850838187726, 6358411077290857510, 7897285047238174514, 18314839336815726031, 4978716052961022367, 17373022694051233817, 663115362299242570, 9811238046242345451, 8113787839071393872, 16155047452816275860, 673245095821315645, 1610087492396736743, 1749670338128618977, 3927771759340679115, 9610589375631783853, 5311608497352460372, 11014490817524419548, 6320099928172676090, 12513554919020212402, 6823504187935853178, 1215405011954300226, 8109228150255944821, 4122548551796094879, 16544885818373129566, 5597102191057004591, 11690994260783567085, 9374498734039011409, 18246806104446739078, 2337407889179712900, 12608919248151905477, 7641631838640172886, 8421574250687361351, 8697189342072434208, 8766286633078002696, 14800090277885439654, 17865860059234099833, 4673315107448681522, 14288183874156623863, 7587575203648284614, 9109213819045273474, 11817665411945280786, 1745089530919138651, 5730370365819793488, 5496865518262805451])
    }
    
    func testXoshiro256StarStar2() {
        var rng = Xoshiro256StarStar(state: testSeed)
        XCTAssertEqual((0..<100).map { _ in Int.random(in: 0..<100000, using: &rng)}, [5988, 53219, 2961, 86036, 4502, 80080, 19042, 34469, 42811, 99284, 26989, 94179, 3594, 53186, 43984, 87576, 3649, 8728, 9484, 21292, 52099, 28794, 59709, 34261, 67836, 36990, 6588, 43960, 22348, 89690, 30341, 63377, 50819, 98916, 12671, 68353, 41425, 45653, 47147, 47522, 80231, 96851, 25334, 77456, 41132, 49381, 64063, 9460, 31064, 29798, 78378, 48981, 78122, 10704, 86495, 4918, 43062, 36678, 14064, 44457, 87660, 17369, 17348, 97825, 34629, 96415, 46183, 60143, 9062, 92278, 38453, 15708, 46958, 65855, 36493, 80344, 79770, 2819, 53491, 76260, 33807, 46479, 2387, 69780, 69943, 41468, 46832, 61473, 53574, 65052, 13404, 78186, 49742, 39414, 68274, 26324, 72069, 87403, 29973, 52599])
    }
    
    func testWeightedRandomGenerator() {
        var rng = Xoshiro256StarStar(state: testSeed)
        let weights = [2, 1, 4, 5]
        let generator = WeightedRandomGenerator(weights)
        var counts = Array<Int>(repeating: 0, count: weights.count)
        for _ in 0 ..< 100000 {
            counts[generator.pick(using: &rng)] += 1
        }
        XCTAssertEqual(counts, [16553, 8349, 33291, 41807])
    }
}
